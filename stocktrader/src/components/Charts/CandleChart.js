import React,{useEffect, useContext, useState} from 'react';
import ReactApexChart from "react-apexcharts";
import dayjs from "dayjs";
import { makeStyles } from '@material-ui/core/styles';
import Axios from 'axios';
import {MainpageSymbolsContext} from '../ProfileContexts/SymbolsProvider';


const useStyles = makeStyles((theme) => ({
  formControl: {
    margin: theme.spacing(1),
    minWidth: 120,
  },
  root: {
    width: 700,
    alignContent: "center"
  },
  selectEmpty: {
    marginTop: theme.spacing(2),
  },
  container: {
    maxWidth: "100%",
  },
  }
));


function CandleChart() {
    const [Symbols, setSymbols] = useContext(MainpageSymbolsContext);
    const [SelectedStockSymbol, setSelectedStokSymbol] = useState("AAPL");
    const [SelectedStockData, setSelectedStockData] = useState([
      {
        "x": "2020-12-03T14:30:00.000+00:00",
        "y": [
          123.52,
          123.78,
          123.26,
          123.37
        ]
      },
      {
        "x": "2020-12-03T14:35:00.000+00:00",
        "y": [
          123.37,
          123.52,
          123.03,
          123.23
        ]
      },
      {
        "x": "2020-12-03T14:40:00.000+00:00",
        "y": [
          123.23,
          123.3,
          122.84,
          122.86
        ]
      },
      {
        "x": "2020-12-03T14:45:00.000+00:00",
        "y": [
          122.87,
          123.16,
          122.69,
          123.16
        ]
      },
      {
        "x": "2020-12-03T14:50:00.000+00:00",
        "y": [
          123.16,
          123.27,
          122.76,
          122.83
        ]
      },
      {
        "x": "2020-12-03T14:55:00.000+00:00",
        "y": [
          122.84,
          123.19,
          122.78,
          123.16
        ]
      },
      {
        "x": "2020-12-03T15:00:00.000+00:00",
        "y": [
          123.16,
          123.16,
          122.92,
          122.99
        ]
      },
      {
        "x": "2020-12-03T15:05:00.000+00:00",
        "y": [
          122.99,
          123.08,
          122.88,
          122.97
        ]
      },
      {
        "x": "2020-12-03T15:10:00.000+00:00",
        "y": [
          122.97,
          123.06,
          122.85,
          122.92
        ]
      },
      {
        "x": "2020-12-03T15:15:00.000+00:00",
        "y": [
          122.92,
          123.26,
          122.87,
          123.25
        ]
      },
      {
        "x": "2020-12-03T15:20:00.000+00:00",
        "y": [
          123.26,
          123.45,
          123.23,
          123.39
        ]
      },
      {
        "x": "2020-12-03T15:25:00.000+00:00",
        "y": [
          123.39,
          123.4,
          122.9,
          122.91
        ]
      },
      {
        "x": "2020-12-03T15:30:00.000+00:00",
        "y": [
          122.91,
          123.2,
          122.85,
          123.05
        ]
      },
      {
        "x": "2020-12-03T15:35:00.000+00:00",
        "y": [
          123.06,
          123.27,
          122.94,
          123.06
        ]
      },
      {
        "x": "2020-12-03T15:40:00.000+00:00",
        "y": [
          123.05,
          123.11,
          122.88,
          122.94
        ]
      },
      {
        "x": "2020-12-03T15:45:00.000+00:00",
        "y": [
          122.94,
          123.05,
          122.9,
          122.91
        ]
      },
      {
        "x": "2020-12-03T15:50:00.000+00:00",
        "y": [
          122.92,
          122.93,
          122.72,
          122.92
        ]
      },
      {
        "x": "2020-12-03T15:55:00.000+00:00",
        "y": [
          122.92,
          122.97,
          122.58,
          122.6
        ]
      },
      {
        "x": "2020-12-03T16:00:00.000+00:00",
        "y": [
          122.61,
          122.78,
          122.57,
          122.65
        ]
      },
      {
        "x": "2020-12-03T16:05:00.000+00:00",
        "y": [
          122.64,
          122.75,
          122.35,
          122.38
        ]
      },
      {
        "x": "2020-12-03T16:10:00.000+00:00",
        "y": [
          122.37,
          122.46,
          122.21,
          122.4
        ]
      },
      {
        "x": "2020-12-03T16:15:00.000+00:00",
        "y": [
          122.4,
          122.64,
          122.39,
          122.58
        ]
      },
      {
        "x": "2020-12-03T16:20:00.000+00:00",
        "y": [
          122.58,
          122.7,
          122.52,
          122.69
        ]
      },
      {
        "x": "2020-12-03T16:25:00.000+00:00",
        "y": [
          122.69,
          122.88,
          122.68,
          122.82
        ]
      },
      {
        "x": "2020-12-03T16:30:00.000+00:00",
        "y": [
          122.83,
          122.98,
          122.81,
          122.86
        ]
      },
      {
        "x": "2020-12-03T16:35:00.000+00:00",
        "y": [
          122.86,
          122.93,
          122.78,
          122.82
        ]
      },
      {
        "x": "2020-12-03T16:40:00.000+00:00",
        "y": [
          122.82,
          122.97,
          122.81,
          122.93
        ]
      },
      {
        "x": "2020-12-03T16:45:00.000+00:00",
        "y": [
          122.92,
          122.98,
          122.85,
          122.97
        ]
      },
      {
        "x": "2020-12-03T16:50:00.000+00:00",
        "y": [
          122.97,
          123.1,
          122.92,
          123.09
        ]
      },
      {
        "x": "2020-12-03T16:55:00.000+00:00",
        "y": [
          123.1,
          123.19,
          123.04,
          123.1
        ]
      },
      {
        "x": "2020-12-03T17:00:00.000+00:00",
        "y": [
          123.1,
          123.23,
          123.0,
          123.12
        ]
      },
      {
        "x": "2020-12-03T17:05:00.000+00:00",
        "y": [
          123.12,
          123.2,
          123.0,
          123.0
        ]
      },
      {
        "x": "2020-12-03T17:10:00.000+00:00",
        "y": [
          123.0,
          123.05,
          122.85,
          122.9
        ]
      },
      {
        "x": "2020-12-03T17:15:00.000+00:00",
        "y": [
          122.91,
          123.0,
          122.78,
          122.89
        ]
      },
      {
        "x": "2020-12-03T17:20:00.000+00:00",
        "y": [
          122.88,
          123.01,
          122.84,
          122.99
        ]
      },
      {
        "x": "2020-12-03T17:25:00.000+00:00",
        "y": [
          122.99,
          123.03,
          122.88,
          122.91
        ]
      },
      {
        "x": "2020-12-03T17:30:00.000+00:00",
        "y": [
          122.91,
          123.2,
          122.85,
          122.95
        ]
      },
      {
        "x": "2020-12-03T17:35:00.000+00:00",
        "y": [
          122.94,
          122.96,
          122.83,
          122.94
        ]
      },
      {
        "x": "2020-12-03T17:40:00.000+00:00",
        "y": [
          122.94,
          123.04,
          122.92,
          123.0
        ]
      },
      {
        "x": "2020-12-03T17:45:00.000+00:00",
        "y": [
          123.0,
          123.07,
          122.74,
          122.93
        ]
      },
      {
        "x": "2020-12-03T17:50:00.000+00:00",
        "y": [
          122.94,
          122.98,
          122.87,
          122.93
        ]
      },
      {
        "x": "2020-12-03T17:55:00.000+00:00",
        "y": [
          122.93,
          123.0,
          122.85,
          122.88
        ]
      },
      {
        "x": "2020-12-03T18:00:00.000+00:00",
        "y": [
          122.88,
          122.97,
          122.85,
          122.88
        ]
      },
      {
        "x": "2020-12-03T18:05:00.000+00:00",
        "y": [
          122.88,
          122.88,
          122.72,
          122.77
        ]
      },
      {
        "x": "2020-12-03T18:10:00.000+00:00",
        "y": [
          122.78,
          122.85,
          122.73,
          122.79
        ]
      },
      {
        "x": "2020-12-03T18:15:00.000+00:00",
        "y": [
          122.8,
          123.0,
          122.76,
          122.98
        ]
      },
      {
        "x": "2020-12-03T18:20:00.000+00:00",
        "y": [
          122.98,
          122.99,
          122.84,
          122.91
        ]
      },
      {
        "x": "2020-12-03T18:25:00.000+00:00",
        "y": [
          122.91,
          123.03,
          122.87,
          122.99
        ]
      },
      {
        "x": "2020-12-03T18:30:00.000+00:00",
        "y": [
          122.98,
          123.01,
          122.82,
          122.84
        ]
      },
      {
        "x": "2020-12-03T18:35:00.000+00:00",
        "y": [
          122.85,
          122.89,
          122.75,
          122.79
        ]
      },
      {
        "x": "2020-12-03T18:40:00.000+00:00",
        "y": [
          122.8,
          122.83,
          122.75,
          122.8
        ]
      },
      {
        "x": "2020-12-03T18:45:00.000+00:00",
        "y": [
          122.79,
          122.8,
          122.61,
          122.74
        ]
      },
      {
        "x": "2020-12-03T18:50:00.000+00:00",
        "y": [
          122.74,
          122.84,
          122.7,
          122.76
        ]
      },
      {
        "x": "2020-12-03T18:55:00.000+00:00",
        "y": [
          122.75,
          122.8,
          122.6,
          122.66
        ]
      },
      {
        "x": "2020-12-03T19:00:00.000+00:00",
        "y": [
          122.67,
          122.76,
          122.62,
          122.68
        ]
      },
      {
        "x": "2020-12-03T19:05:00.000+00:00",
        "y": [
          122.67,
          122.82,
          122.66,
          122.79
        ]
      },
      {
        "x": "2020-12-03T19:10:00.000+00:00",
        "y": [
          122.8,
          122.95,
          122.78,
          122.91
        ]
      },
      {
        "x": "2020-12-03T19:15:00.000+00:00",
        "y": [
          122.91,
          123.01,
          122.9,
          122.93
        ]
      },
      {
        "x": "2020-12-03T19:20:00.000+00:00",
        "y": [
          122.93,
          122.95,
          122.83,
          122.86
        ]
      },
      {
        "x": "2020-12-03T19:25:00.000+00:00",
        "y": [
          122.85,
          122.89,
          122.73,
          122.86
        ]
      },
      {
        "x": "2020-12-03T19:30:00.000+00:00",
        "y": [
          122.86,
          123.01,
          122.81,
          122.99
        ]
      },
      {
        "x": "2020-12-03T19:35:00.000+00:00",
        "y": [
          122.98,
          123.03,
          122.94,
          122.99
        ]
      },
      {
        "x": "2020-12-03T19:40:00.000+00:00",
        "y": [
          122.99,
          123.0,
          122.9,
          122.98
        ]
      },
      {
        "x": "2020-12-03T19:45:00.000+00:00",
        "y": [
          122.98,
          122.99,
          122.87,
          122.9
        ]
      },
      {
        "x": "2020-12-03T19:50:00.000+00:00",
        "y": [
          122.89,
          122.99,
          122.88,
          122.99
        ]
      },
      {
        "x": "2020-12-03T19:55:00.000+00:00",
        "y": [
          122.98,
          123.1,
          122.91,
          123.04
        ]
      },
      {
        "x": "2020-12-03T20:00:00.000+00:00",
        "y": [
          123.04,
          123.05,
          122.94,
          123.02
        ]
      },
      {
        "x": "2020-12-03T20:05:00.000+00:00",
        "y": [
          123.03,
          123.06,
          122.96,
          123.0
        ]
      },
      {
        "x": "2020-12-03T20:10:00.000+00:00",
        "y": [
          123.0,
          123.22,
          122.99,
          123.2
        ]
      },
      {
        "x": "2020-12-03T20:15:00.000+00:00",
        "y": [
          123.19,
          123.2,
          123.14,
          123.14
        ]
      },
      {
        "x": "2020-12-03T20:20:00.000+00:00",
        "y": [
          123.14,
          123.28,
          123.13,
          123.26
        ]
      },
      {
        "x": "2020-12-03T20:25:00.000+00:00",
        "y": [
          123.26,
          123.33,
          123.19,
          123.22
        ]
      },
      {
        "x": "2020-12-03T20:30:00.000+00:00",
        "y": [
          123.23,
          123.33,
          123.19,
          123.22
        ]
      },
      {
        "x": "2020-12-03T20:35:00.000+00:00",
        "y": [
          123.24,
          123.28,
          123.07,
          123.08
        ]
      },
      {
        "x": "2020-12-03T20:40:00.000+00:00",
        "y": [
          123.08,
          123.08,
          122.53,
          122.84
        ]
      },
      {
        "x": "2020-12-03T20:45:00.000+00:00",
        "y": [
          122.84,
          123.05,
          122.71,
          123.02
        ]
      },
      {
        "x": "2020-12-03T20:50:00.000+00:00",
        "y": [
          123.04,
          123.05,
          122.55,
          122.66
        ]
      },
      {
        "x": "2020-12-03T20:55:00.000+00:00",
        "y": [
          122.67,
          123.05,
          122.59,
          122.94
        ]
      },
      {
        "x": "2020-12-03T21:00:00.000+00:00",
        "y": [
          123.03,
          123.05,
          122.73,
          122.89
        ]
      }
    ]);
    
    const classes = useStyles(); 

    {/*}
    useEffect(() => {
      console.log("CANDLE CHART IS LOADED");
      console.log(Symbols);
      const resp = Axios.get(`http://localhost:8080/stock/getcandle/${SelectedStockSymbol}/5`);
      setSelectedStockData(resp.reactCandleDataList);
      console.log("SELECTED DATA STOCK: ", SelectedStockData);
    },[SelectedStockSymbol]);
  */}



    const series = [{
        name: 'candle',
        data: SelectedStockData? SelectedStockData : 0
      }];

      const options = {
        chart: {
          height: 350,
          type: 'candlestick',
        },
        title: {
          text: `Candle chart of: ${SelectedStockSymbol}`,
          align: 'center'
        },
        annotations: {
          xaxis: [
            {
              x: 'Oct 06 14:00',
              borderColor: '#00E396',
              label: {
                borderColor: '#00E396',
                style: {
                  fontSize: '12px',
                  color: '#fff',
                  background: '#00E396'
                },
                orientation: 'horizontal',
                offsetY: 7,
                text: 'Annotation Test'
              }
            }
          ]
        },
        tooltip: {
          enabled: true,
        },
        xaxis: {
          type: 'category',
          labels: {
            formatter: function(val) {
              return dayjs(val).format('MMM DD HH:mm')
            }
          }
        },
        yaxis: {
          tooltip: {
            enabled: true
            }
        }
    };

    return(
        <div className={classes.container}>
            <ReactApexChart options={options} series={series} type="candlestick" height={350} />
        </div>
    )
};

export default CandleChart; 